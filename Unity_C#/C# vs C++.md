# C# vs C++



주요 차이점으로 나오는게 C#은 GC가 달려 있어서 C++보다 느리다! 라는 이야기들입니다. 그런데 C++도 GC와 동일하게 delete를 한다면 사실상 비슷한 작업을 하기에 완벽한 답이 될 수는 없습니다. 때문에 이번에 C#과 C++의 `속도`를 중점으로 해서 비교하는 문제에 대한 답을 어느정도 적어보려고 합니다.

물론 필자 또한 완벽한 답을 아직 이끌어내지 못했기에 아래 글들과 참고 자료들, 본인의 검색 결과 등을 바탕으로 면접때 대답하는걸 추천드리겠습니다.



## GC

둘의 큰 차이를 고른다면 가장 이런게 나오지 않을까 합니다.

일단 C#의 GC는 `Mark and Sweep`알고리즘에 기반을 두고 있으므로 힙에 할당된 객체에 대한 포인터 추적을 실행하게 됩니다. 이로 인해서 C++의 생성-소멸 주기보다는 오버헤드가 걸리는게 맞습니다. 그리고 수많은 객체들을 생성한 후 나중에 GC를 돌리게 되면 더 많은 시간을 사용하게 되므로 속도가 더 느려지게 됩니다.

C#이 마냥 관망하는건 아니라서 세대 기반 알고리즘을 도입해 '살아 있을 가능성이 있는 객체'를 뒤로 물러나게 해 GC 시간을 줄이는 등의 노력을 하고 있습니다. 때문에 GC 작업으로 인한 차이를 재는게 무의미하다 라고 하는 의견들이 더럿 있었습니다.



## 가상 머신 (VM - Virtual Machine)

VM에 대해서도 마냥 '이거 때문에 느리다!'라고 이야기 할 수 없습니다.

'VM을 사용하면 느리다'라는 말이 나오는 주된 이유는 초기 구동시에 JIT 컴파일러를 위해 한번 대기하는 과정이 있어서 라고 합니다. 다만 이 경우 한번 실행이 되면 이후에는 여러번 사용할 수 있기에 이에 대한 오버헤드를 잘 살펴봐야 합니다. (대부분의 언어 벤치마크들이 욕먹는 이유중 하나)

일단 C++로 작성된 프로그램은 대부분 32비트 코드로 컴파일이 되며 64비트 프로세서에서도 32비트로 돌아가게 됩니다. JIT를 사용하는 C#의 경우 타겟 플랫폼에 대한 이해도를 가질 수 있어서 64비트에 맞춰 컴파일을 할 것입니다. 때문에 이런 부분에 있어서 장점을 가질 수도 있습니다. (C++로 이 작업을 하려면 복잡하고 비슷한 결과가 나올 것으로 예측됨)



## C++의 TMP, C#의 리플렉션

C++의 TMP는 정적인 프로그램으로 컴파일 시간에 계산을 할 수 있다는 장점이 있습니다. 다만 이 경우 런타임에 수행될 수 없다는 단점이 있습니다. 예시로 TMP로 팩토리얼을 O(1)로 계산할 수 있지만 이는 컴파일 타임, 사용자 입력에 따른 유동성을 고려하지 않은 것입니다.

C#의 경우에는 런타임에 리플렉션을 통해 수행을 하게 됩니다. 때문에 '런타임'이라는 특성만 보고 느리다고 할 수 있는데 이에 대한건 확실히 trade-off가 있는 것입니다.



## 필자의 결론

이런 이야기들을 보면 마냥 C#을 느리다고는 할 수 없지만 대부분의 경우에서 C++이 속도적으로 우세하다는 이야기를 들을 수 있습니다. 하지만 이는 '대부분'으로 100%라는 뜻은 아니죠. 때문에 단순하게 나오는 벤치마크를 믿고 다니기 보다는 본인만의 환경에서, 본인 프로그램에 대한 코드를 작성해 봤을 때 성능 비교가 중요하다는 생각이 듭니다.

'C#이 사실 더 빠르다!', 'C++이 더 빠르다!'와 같은 명확한 답변을 원하셨을 수 있는데 필자의 역량과 경험이 뛰어나지 않아 이 부분에 대한 질의를 완성할 수 없음에 아쉬움을 느낍니다.

혹시나 이에 대해 아시는 정보들을 기여하고 싶으시다면 해당 리포지토리의 README를 참고해 기여해주시면 감사하겠습니다.



### 주요 참고 자료

[StackOverflow - Is C# really slower than say C++](https://stackoverflow.com/questions/5326269/is-c-sharp-really-slower-than-say-c)