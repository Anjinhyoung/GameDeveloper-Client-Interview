# Unity & C#의 GC

C++과의 대표적인 차이가 GC의 유무 입니다.



일단 C#, 즉 .Net 의 GC는 `Mark and Sweep` 알고리즘을 사용하고 있습니다. 이를 간단하게 설명하겠습니다.

- 전역 변수, 현재 함수의 로컬 변수 등을 Root로 잡게 됩니다.
- 이 Root를 기반으로 점점 참조를 타고 다니면서 방문한 것들을 Mark 해줍니다.
- 이러한 Mark 작업이 끝나게 된다면 이후 Sweep 단계로 진입합니다.
- Sweep 단계에서는 Mark 되지 않은 것들을 가비지로 판단해 처리하게 됩니다.

이런 작업을 거쳐 GC가 동작을 하게 됩니다.



## .Net과 Unity의 GC

이 둘의 차이에 대한 질문들도 자주 나오게 됩니다.

일단 내부적으로 GC의 알고리즘은 `Mark and Sweep`를 기반으로 하게 되는데 그 이후의 과정이 다르게 됩니다. 

.Net에서는 0~2세대까지 총 3개의 세대를 통해서 관리를 하게 됩니다.

유니티에서는 [`Boehm-Demers-Weiser`](https://www.hboehm.info/gc/gcdescr.html) 라는 알고리즘을 통해 GC 작업을 하게 됩니다. `Mark and Sweep`인것은 같으나 세대 구분이 없고 메모리 정렬도 없습니다. 때문에 19 버전 이상에서 제공하게 되는 점진적 GC 작업을 활용하거나 오브젝트 풀링 등의 기법을 활용해서 최대한 최적화를 해줘야 할 필요가 있습니다.



## 상호 참조 해결법

C#에서 상호참조중인 객체 해제에 대해서는 위 `Mark and Sweep` 알고리즘을 설명하면 됩니다.

만일 두 객체가 서로 참조중이라 하더라도 외부에서 참조가 없어 Mark 되지 않는다면 Sweep 단계에서 해제되게 됩니다.